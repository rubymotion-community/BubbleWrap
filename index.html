<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>BubbleWrap - A RubyMotion Cocoa wrapper</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-30927742-1']);
      _gaq.push(['_trackPageview']);

      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();

     </script>
   </head>
   <body>
     <div class="wrapper">
       <header>
         <h1>BubbleWrap</h1>
         <p>
           Cocoa wrappers and helpers for <a href="http://www.rubymotion.com/">RubyMotion</a>.
         </p>
         <p class="view">
           <a href="https://github.com/rubymotion/BubbleWrap">View the Project on GitHub <small>rubymotion/BubbleWrap</small></a>
           <a href="http://rdoc.info/github/rubymotion/BubbleWrap/master/frames">Read the RDoc<small>rdoc.info</small></a>
           <a href="http://rubygems.org/gems/bubble-wrap">Get the Ruby Gem<small>gem 'bubble-wrap'</small></a>
           <a href="https://groups.google.com/d/forum/bubblewrap">Join the discussion<small>bubblewrap@googlegroups.com</small></a>
           <a href="getting_started.html">Using BubbleWrap<small>A guide to getting started with BubbleWrap</small></a>
           <a href="hacking.html">Hacking BubbleWrap<small>A guide to working on BubbleWrap</small></a>
           <a href="gem.html">Gem Howto<small>Building RubyMotion gems with BW</small></a>
         </p>
       </header>
       <section>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h1>BubbleWrap for RubyMotion</h1>

<p>A collection of (tested) helpers and wrappers used to wrap Cocoa Touch and AppKit code and provide more Ruby like APIs.</p>

<p><a href="http://rubymotion.github.io/BubbleWrap/">BubbleWrap website</a>
<a href="https://groups.google.com/forum/#!forum/bubblewrap">BubbleWrap mailing list</a></p>

<p><a href="https://codeclimate.com/github/rubymotion/BubbleWrap"><img src="https://codeclimate.com/github/rubymotion/BubbleWrap.svg" alt="Code Climate"></a>
<a href="https://travis-ci.org/rubymotion/BubbleWrap"><img src="https://travis-ci.org/rubymotion/BubbleWrap.svg?branch=master" alt="Build Status"></a>
<a href="http://badge.fury.io/rb/bubble-wrap"><img src="https://badge.fury.io/rb/bubble-wrap.png" alt="Gem Version"></a>
<a href="https://gemnasium.com/rubymotion/BubbleWrap"><img src="https://gemnasium.com/rubymotion/BubbleWrap.png" alt="Dependency Status"></a></p>

<h2>Installation</h2>

<div class="highlight">
<pre><span class="n">gem</span> <span class="n">install</span> <span class="n">bubble</span><span class="o">-</span><span class="n">wrap</span>
</pre>
</div>


<h2>Setup</h2>

<ol>
<li>Edit the <code>Rakefile</code> of your RubyMotion project and add the following require line:</li>
</ol>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap'</span>
</pre>
</div>


<p>If you use Bundler:</p>

<div class="highlight">
<pre><span class="n">gem</span> <span class="s2">"bubble-wrap"</span><span class="p">,</span> <span class="s2">"~&gt; 1.9.2"</span>
</pre>
</div>


<p>BubbleWrap is split into multiple modules so that you can easily choose which parts are included at compile-time.</p>

<p>If you wish to only include the <code>RSS Parser</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/rss_parser'</span>
</pre>
</div>


<p>If you wish to only include the <code>Reactor</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/reactor'</span>
</pre>
</div>


<p>If you wish to only include the UI-related wrappers:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/ui'</span>
</pre>
</div>


<p>If you wish to only include the <code>Camera</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/camera'</span>
</pre>
</div>


<p>If you wish to only include the <code>Location</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/location'</span>
</pre>
</div>


<p>If you wish to only include the <code>Media</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/media'</span>
</pre>
</div>


<p>If you wish to only include the <code>Mail</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/mail'</span>
</pre>
</div>


<p>If you wish to only include the <code>SMS</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/sms'</span>
</pre>
</div>


<p>If you wish to only include the <code>Motion</code> (CoreMotion) wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/motion'</span>
</pre>
</div>


<p>If you wish to only include the <code>NetworkIndicator</code> wrapper:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/network-indicator'</span>
</pre>
</div>


<p>If you want to include everything (ie kitchen sink mode) you can save time and do:</p>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'bubble-wrap/all'</span>
</pre>
</div>


<p>You can also do this directly in your <code>Gemfile</code> like so:</p>

<div class="highlight">
<pre><span class="n">gem</span> <span class="s1">'bubble-wrap'</span><span class="p">,</span> <span class="nb">require</span><span class="p">:</span> <span class="sx">%w[bubble-wrap/core bubble-wrap/location, bubble-wrap/reactor]</span>
</pre>
</div>


<p>Note: <strong>DON'T</strong> use <code>app.files =</code> in your Rakefile to set up your files once you've required BubbleWrap.
Make sure to append onto the array or use <code>+=</code>.</p>

<ol>
<li>Now, you can use BubbleWrap extension in your app:</li>
</ol>

<div class="highlight">
<pre><span class="k">class</span> <span class="nc">AppDelegate</span>
  <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="ss">didFinishLaunchingWithOptions</span><span class="p">:</span><span class="n">launchOptions</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="no">App</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="no">App</span><span class="o">.</span><span class="n">documents_path</span><span class="si">}</span><span class="s2">)"</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>


<p>Note: You can also vendor this repository but the recommended way is to
use the versioned gem.</p>

<h2>Core</h2>

<h3>Misc</h3>

<p>UUID generator:</p>

<div class="highlight">
<pre><span class="no">BubbleWrap</span><span class="o">.</span><span class="n">create_uuid</span>
<span class="o">=&gt;</span> <span class="s2">"68ED21DB-82E5-4A56-ABEB-73650C0DB701"</span>
</pre>
</div>


<p>Localization (using <code>NSBundle.mainBundle.localizedStringForKey</code>):</p>

<div class="highlight">
<pre><span class="no">BubbleWrap</span><span class="o">.</span><span class="n">localized_string</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="s1">'fallback'</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">"fallback"</span>
</pre>
</div>


<p>Color conversion:</p>

<div class="highlight">
<pre><span class="no">BubbleWrap</span><span class="o">.</span><span class="n">rgba_color</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">4</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;UIDeviceRGBColor:0x6db6ed0&gt;</span>
<span class="no">BubbleWrap</span><span class="o">.</span><span class="n">rgb_color</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;UIDeviceRGBColor:0x8ca88b0&gt;</span>
<span class="s1">'blue'</span><span class="o">.</span><span class="n">to_color</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;UICachedDeviceRGBColor:0xda535c0&gt;</span>
<span class="s1">'dark_gray'</span><span class="o">.</span><span class="n">to_color</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;UICachedDeviceWhiteColor:0x8bb5be0&gt;</span>
<span class="s1">'#FF8A19'</span><span class="o">.</span><span class="n">to_color</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;UIDeviceRGBColor:0x8d54110&gt;</span>
<span class="s1">'#88FF8A19'</span><span class="o">.</span><span class="n">to_color</span> <span class="c1"># ARGB format</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;UIDeviceRGBColor:0xca0fe00&gt;</span>
</pre>
</div>


<p>Debug flag:</p>

<div class="highlight">
<pre><span class="no">BubbleWrap</span><span class="o">.</span><span class="n">debug?</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
<span class="no">BubbleWrap</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kp">true</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="no">BubbleWrap</span><span class="o">.</span><span class="n">debug?</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
</pre>
</div>


<h3>App</h3>

<p>A module with useful methods related to the running application</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">documents_path</span>
<span class="c1"># "/Users/mattetti/Library/Application Support/iPhone Simulator/5.0/Applications/EEC6454E-1816-451E-BB9A-EE18222E1A8F/Documents"</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">resources_path</span>
<span class="c1"># "/Users/mattetti/Library/Application Support/iPhone Simulator/5.0/Applications/EEC6454E-1816-451E-BB9A-EE18222E1A8F/testSuite_spec.app"</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># "testSuite"</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">identifier</span>
<span class="c1"># "io.bubblewrap.testSuite"</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="s2">"BubbleWrap is awesome!"</span><span class="p">)</span>
<span class="c1"># creates and shows an alert message.</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="s2">"BubbleWrap is awesome!"</span><span class="p">,</span> <span class="p">{</span><span class="ss">cancel_button_title</span><span class="p">:</span> <span class="s2">"I know it is!"</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="s2">"Like, seriously awesome."</span><span class="p">})</span>
<span class="c1"># creates and shows an alert message with optional parameters.</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">run_after</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span>  <span class="nb">p</span> <span class="s2">"It's </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">"</span>   <span class="p">}</span>
<span class="c1"># Runs the block after 0.5 seconds.</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">open_url</span><span class="p">(</span><span class="s2">"http://matt.aimonetti.net"</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">open_url</span><span class="p">(</span><span class="s2">"tel://123456789"</span><span class="p">)</span>
<span class="c1"># Opens the url using the device's browser. Can also open custom URL schemas (accepts a string url or an instance of `NSURL`.)</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">can_open_url</span><span class="p">(</span><span class="s2">"tel://"</span><span class="p">)</span>
<span class="c1"># Returns whether the app can open a given URL resource.</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'channels'</span><span class="o">]</span> <span class="c1"># application specific persistence storage</span>
<span class="c1"># ['NBC', 'ABC', 'Fox', 'CBS', 'PBS']</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'channels'</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'TF1'</span><span class="p">,</span> <span class="s1">'France 2'</span><span class="p">,</span> <span class="s1">'France 3'</span><span class="o">]</span>
<span class="c1"># ['TF1', 'France 2', 'France 3']</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">.</span><span class="n">environment</span>
<span class="c1"># 'test'</span>
</pre>
</div>


<p>Other available methods:</p>

<ul>
<li><code>App.notification_center</code></li>
<li><code>App.user_cache</code></li>
<li><code>App.states</code></li>
<li><code>App.frame</code></li>
<li><code>App.delegate</code></li>
<li><code>App.shared</code></li>
<li><code>App.window</code></li>
<li><code>App.current_locale</code></li>
<li><code>App.release?</code></li>
<li><code>App.test?</code></li>
<li><code>App.development?</code></li>
</ul>

<h3>Device</h3>

<p>A collection of useful methods about the current device:</p>

<p>Examples:</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">iphone?</span>
<span class="c1"># true</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">ipad?</span>
<span class="c1"># false</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">front?</span>
<span class="c1"># true</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rear?</span>
<span class="c1"># true</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">orientation</span>
<span class="c1"># :portrait</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">interface_orientation</span>
<span class="c1"># :portrait</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">simulator?</span>
<span class="c1"># true</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">ios_version</span>
<span class="c1"># "6.0"</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">retina?</span>
<span class="c1"># false</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">width</span>
<span class="c1"># 320</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">height</span>
<span class="c1"># 480</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">width_for_orientation</span><span class="p">(</span><span class="ss">:landscape_left</span><span class="p">)</span>
<span class="c1"># 480</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">height_for_orientation</span><span class="p">(</span><span class="ss">:landscape_left</span><span class="p">)</span>
<span class="c1"># 320</span>
<span class="o">&gt;</span> <span class="no">Device</span><span class="o">.</span><span class="n">vendor_identifier</span>
<span class="c1"># &lt;NSUUID&gt;</span>
</pre>
</div>


<h3>Camera</h3>

<p>Added interface for better camera access:</p>

<div class="highlight">
<pre><span class="c1"># Uses the front camera</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Device</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">picture</span><span class="p">(</span><span class="ss">media_types</span><span class="p">:</span> <span class="o">[</span><span class="ss">:movie</span><span class="p">,</span> <span class="ss">:image</span><span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="n">image_view</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithImage</span><span class="p">(</span><span class="n">result</span><span class="o">[</span><span class="ss">:original_image</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Uses the rear camera</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Device</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rear</span><span class="o">.</span><span class="n">picture</span><span class="p">(</span><span class="ss">media_types</span><span class="p">:</span> <span class="o">[</span><span class="ss">:movie</span><span class="p">,</span> <span class="ss">:image</span><span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="n">image_view</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithImage</span><span class="p">(</span><span class="n">result</span><span class="o">[</span><span class="ss">:original_image</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Uses the photo library</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Device</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">any</span><span class="o">.</span><span class="n">picture</span><span class="p">(</span><span class="ss">media_types</span><span class="p">:</span> <span class="o">[</span><span class="ss">:movie</span><span class="p">,</span> <span class="ss">:image</span><span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="n">image_view</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithImage</span><span class="p">(</span><span class="n">result</span><span class="o">[</span><span class="ss">:original_image</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Lets the user edit the photo (with access to the edited and original photos)</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Device</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">any</span><span class="o">.</span><span class="n">picture</span><span class="p">(</span><span class="ss">allows_editing</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">media_types</span><span class="p">:</span> <span class="o">[</span><span class="ss">:image</span><span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="n">edited_image_view</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithImage</span><span class="p">(</span><span class="n">result</span><span class="o">[</span><span class="ss">:edited_image</span><span class="o">]</span><span class="p">)</span>
  <span class="n">original_image_view</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithImage</span><span class="p">(</span><span class="n">result</span><span class="o">[</span><span class="ss">:original_image</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Capture a low quality movie with a limit of 10 seconds</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Device</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">front</span><span class="o">.</span><span class="n">picture</span><span class="p">(</span><span class="ss">media_types</span><span class="p">:</span> <span class="o">[</span><span class="ss">:movie</span><span class="o">]</span><span class="p">,</span> <span class="ss">video_quality</span><span class="p">:</span> <span class="ss">:low</span><span class="p">,</span> <span class="ss">video_maximum_duration</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="n">video_file_path</span> <span class="o">=</span> <span class="n">result</span><span class="o">[</span><span class="ss">:media_url</span><span class="o">]</span>
<span class="k">end</span>
</pre>
</div>


<p>Options include:</p>

<ul>
<li>
<code>:allows_editing</code> - Boolean; whether a user can edit the photo/video before picking</li>
<li>
<code>:animated</code> - Boolean; whether to display the camera with an animation (default true)</li>
<li>
<code>:on_dismiss</code> - Lambda; called instead of the default dismissal logic</li>
<li>
<code>:media_types</code> - Array; containing any of <code>[:movie, :image]</code>
</li>
<li>
<code>:video_quality</code> - Symbol; one of <code>:high</code>, <code>:medium</code>, <code>low</code>, <code>"640x480".to_sym</code>, <code>iframe1280x720</code>, or <code>iframe960x540</code>. Defaults to <code>:medium</code>
</li>
<li>
<code>:video_maximum_duration</code> - Integer; limits movie recording length. Defaults to 600.</li>
</ul>

<h3>JSON</h3>

<p><code>BW::JSON</code> wraps <code>NSJSONSerialization</code> available in iOS5 and offers the same API as Ruby's JSON std lib. For apps building for iOS4, we suggest a different JSON alternative, like <a href="https://github.com/mattt/AnyJSON">AnyJSON</a>.</p>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">JSON</span><span class="o">.</span><span class="n">generate</span><span class="p">({</span><span class="s1">'foo'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'bar'</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="s1">'baz'</span> <span class="o">=&gt;</span> <span class="s1">'awesome'</span><span class="p">})</span>
<span class="o">=&gt;</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">foo</span><span class="se">\"</span><span class="s2">:1,</span><span class="se">\"</span><span class="s2">bar</span><span class="se">\"</span><span class="s2">:[1,2,3],</span><span class="se">\"</span><span class="s2">baz</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">awesome</span><span class="se">\"</span><span class="s2">}"</span>
<span class="no">BW</span><span class="o">::</span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">foo</span><span class="se">\"</span><span class="s2">:1,</span><span class="se">\"</span><span class="s2">bar</span><span class="se">\"</span><span class="s2">:[1,2,3],</span><span class="se">\"</span><span class="s2">baz</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">awesome</span><span class="se">\"</span><span class="s2">}"</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"foo"</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"bar"</span><span class="o">=&gt;[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="s2">"baz"</span><span class="o">=&gt;</span><span class="s2">"awesome"</span><span class="p">}</span>
</pre>
</div>


<h3>NSIndexPath</h3>

<p>Helper methods added to give <code>NSIndexPath</code> a bit more of a Ruby
interface.</p>

<div class="highlight">
<pre><span class="n">index_path</span> <span class="o">=</span> <span class="n">table_view</span><span class="o">.</span><span class="n">indexPathForCell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
<span class="n">index_path</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># NSIndexPath for next cell in the same section</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;NSIndexPath:0x120db8e0&gt;</span>
</pre>
</div>


<h3>NSNotificationCenter</h3>

<p>Helper methods to give NSNotificationCenter a Ruby-like interface:</p>

<div class="highlight">
<pre><span class="k">def</span> <span class="nf">viewWillAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
  <span class="vi">@foreground_observer</span> <span class="o">=</span> <span class="no">App</span><span class="o">.</span><span class="n">notification_center</span><span class="o">.</span><span class="n">observe</span> <span class="no">UIApplicationWillEnterForegroundNotification</span> <span class="k">do</span> <span class="o">|</span><span class="n">notification</span><span class="o">|</span>
    <span class="n">loadAndRefresh</span>
  <span class="k">end</span>

  <span class="vi">@reload_observer</span> <span class="o">=</span> <span class="no">App</span><span class="o">.</span><span class="n">notification_center</span><span class="o">.</span><span class="n">observe</span> <span class="s1">'ReloadNotification'</span> <span class="k">do</span> <span class="o">|</span><span class="n">notification</span><span class="o">|</span>
    <span class="n">loadAndRefresh</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">viewWillDisappear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
  <span class="no">App</span><span class="o">.</span><span class="n">notification_center</span><span class="o">.</span><span class="n">unobserve</span> <span class="vi">@foreground_observer</span>
  <span class="no">App</span><span class="o">.</span><span class="n">notification_center</span><span class="o">.</span><span class="n">unobserve</span> <span class="vi">@reload_observer</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">reload</span>
  <span class="no">App</span><span class="o">.</span><span class="n">notification_center</span><span class="o">.</span><span class="n">post</span> <span class="s1">'ReloadNotification'</span>
<span class="k">end</span>
</pre>
</div>


<h3>NSUserDefaults</h3>

<p>Helper methods added to the class repsonsible for user preferences used
by the <code>App::Persistence</code> module shown below.</p>

<h3>Persistence</h3>

<p>Offers a way to persist application specific information using a very
simple interface:</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'channels'</span><span class="o">]</span> <span class="c1"># application specific persistence storage</span>
<span class="c1"># ['NBC', 'ABC', 'Fox', 'CBS', 'PBS']</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'channels'</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'TF1'</span><span class="p">,</span> <span class="s1">'France 2'</span><span class="p">,</span> <span class="s1">'France 3'</span><span class="o">]</span>
<span class="c1"># ['TF1', 'France 2', 'France 3']</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'channels'</span><span class="p">)</span>
<span class="c1"># ['TF1', 'France 2', 'France 3']</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">[</span><span class="s1">'something__new'</span><span class="o">]</span> <span class="c1"># something previously never stored</span>
<span class="c1"># nil</span>
<span class="o">&gt;</span> <span class="no">App</span><span class="o">::</span><span class="no">Persistence</span><span class="o">.</span><span class="n">all</span>
<span class="c1"># {'all':'values', 'stored':'by', 'bubblewrap':'as a hash!'}</span>
</pre>
</div>


<h3>Observers</h3>

<p><strong>Since: &gt; version 0.4</strong></p>

<p>You can observe for object's changes and trigger blocks:</p>

<div class="highlight">
<pre><span class="k">class</span> <span class="nc">ExampleViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>
  <span class="kp">include</span> <span class="no">BW</span><span class="o">::</span><span class="no">KVO</span>

  <span class="k">def</span> <span class="nf">viewDidLoad</span>
    <span class="vi">@label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span> <span class="o">[[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="o">]</span><span class="p">,</span><span class="o">[</span><span class="mi">280</span><span class="p">,</span><span class="mi">44</span><span class="o">]]</span>
    <span class="vi">@label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span> <span class="vi">@label</span>

    <span class="n">observe</span><span class="p">(</span><span class="vi">@label</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"Hello from viewDidLoad!"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
    <span class="n">observe</span><span class="p">(</span><span class="vi">@label</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"Hello from viewDidAppear!"</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre>
</div>


<p>You can remove observers using <code>unobserve</code> method.</p>

<p><strong>Since: &gt; version 1.9.0</strong></p>

<p>Optionally, multiple key paths can be passed to the <code>observer</code> method:</p>

<div class="highlight">
<pre><span class="k">class</span> <span class="nc">ExampleViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>
  <span class="kp">include</span> <span class="no">BW</span><span class="o">::</span><span class="no">KVO</span>

  <span class="k">def</span> <span class="nf">viewDidLoad</span>
    <span class="vi">@label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span> <span class="o">[[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="o">]</span><span class="p">,</span><span class="o">[</span><span class="mi">280</span><span class="p">,</span><span class="mi">44</span><span class="o">]]</span>
    <span class="vi">@label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span> <span class="vi">@label</span>

    <span class="n">observe</span><span class="p">(</span><span class="vi">@label</span><span class="p">,</span> <span class="o">[</span><span class="ss">:text</span><span class="p">,</span> <span class="ss">:textColor</span><span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">,</span> <span class="n">key_path</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"Hello from viewDidLoad for </span><span class="si">#{</span><span class="n">key_path</span><span class="si">}</span><span class="s2">!"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>


<p>Also you can use <code>observe!</code> method to register observer that will immediately
return initial value. Note that in this case only new value will be passed to
the block.</p>

<h3>String</h3>

<p>The Ruby <code>String</code> class was extended to add <code>#camelize</code> and
<code>#underscore</code> methods.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="s2">"matt_aimonetti"</span><span class="o">.</span><span class="n">camelize</span>
<span class="o">=&gt;</span> <span class="s2">"MattAimonetti"</span>
<span class="o">&gt;</span> <span class="s2">"MattAimonetti"</span><span class="o">.</span><span class="n">underscore</span>
<span class="o">=&gt;</span> <span class="s2">"matt_aimonetti"</span>
</pre>
</div>


<h3>Time</h3>

<p>The <code>Time</code> Ruby class was added a class level method to convert a
iso8601 formatted string into a Time instance.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">iso8601</span><span class="p">(</span><span class="s2">"2012-05-31T19:41:33Z"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="mi">2012</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mi">31</span> <span class="mi">21</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">33</span> <span class="o">+</span><span class="mo">0200</span>
</pre>
</div>


<h2>Location</h2>

<p>Interface for Ruby-like GPS and compass access (the CoreLocation framework):</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">BW</span><span class="o">::</span><span class="no">Location</span><span class="o">.</span><span class="n">enabled?</span> <span class="c1"># Whether location services are enabled on the device</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">&gt;</span> <span class="no">BW</span><span class="o">::</span><span class="no">Location</span><span class="o">.</span><span class="n">authorized?</span> <span class="c1"># If your app is authorized to use location services</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
</pre>
</div>


<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">Location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="ss">purpose</span><span class="p">:</span> <span class="s1">'We need to use your GPS because...'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="nb">p</span> <span class="s2">"From Lat </span><span class="si">#{</span><span class="n">result</span><span class="o">[</span><span class="ss">:from</span><span class="o">].</span><span class="n">latitude</span><span class="si">}</span><span class="s2">, Long </span><span class="si">#{</span><span class="n">result</span><span class="o">[</span><span class="ss">:from</span><span class="o">].</span><span class="n">longitude</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">p</span> <span class="s2">"To Lat </span><span class="si">#{</span><span class="n">result</span><span class="o">[</span><span class="ss">:to</span><span class="o">].</span><span class="n">latitude</span><span class="si">}</span><span class="s2">, Long </span><span class="si">#{</span><span class="n">result</span><span class="o">[</span><span class="ss">:to</span><span class="o">].</span><span class="n">longitude</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre>
</div>


<p><em>Note: <code>result[:from]</code> will return <code>nil</code> the first time location services are started.</em></p>

<p>The <code>:previous</code> key in the <code>BW::Location.get()</code> result hash will always return an array of zero or more additional <code>CLLocation</code> objects aside from the locations returned from the <code>:to</code> and <code>:from</code> hash keys.  While in most scenarios this array will be empty, per <a href="https://developer.apple.com/library/IOs/documentation/CoreLocation/Reference/CLLocationManagerDelegate_Protocol/index.html#//apple_ref/occ/intfm/CLLocationManagerDelegate/locationManager:didUpdateLocations:">Apple's Documentation</a> if there are deferred updates or multiple locations that arrived before they could be delivered, multiple locations will be returned in an order of oldest to newest.</p>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">Location</span><span class="o">.</span><span class="n">get_compass</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:magnetic_heading</span><span class="o">]</span> <span class="c1"># Heading towards magnetic north</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:true_heading</span><span class="o">]</span> <span class="c1"># Heading towards true north</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:accuracy</span><span class="o">]</span> <span class="c1"># Potential error between magnetic and true heading</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:timestamp</span><span class="o">]</span> <span class="c1"># Timestamp of the heading calculation</span>
<span class="k">end</span>
</pre>
</div>


<p><code>BW::Location.get_significant</code> is also available, for monitoring significant location changes.</p>

<p><code>BW::Location</code> also supports <code>get_once</code>-style methods, which will return the first result before ending the search:</p>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">Location</span><span class="o">.</span><span class="n">get_once</span><span class="p">(</span><span class="ss">desired_accuracy</span><span class="p">:</span> <span class="ss">:three_kilometers</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">CLLocation</span><span class="p">)</span>
    <span class="nb">p</span> <span class="n">result</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">latitude</span>
    <span class="nb">p</span> <span class="n">result</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">longitude</span>
  <span class="k">else</span>
    <span class="nb">p</span> <span class="s2">"ERROR: </span><span class="si">#{</span><span class="n">result</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">BW</span><span class="o">::</span><span class="no">Location</span><span class="o">.</span><span class="n">get_compass_once</span> <span class="k">do</span> <span class="o">|</span><span class="n">heading</span><span class="o">|</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:magnetic_heading</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:true_heading</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:accuracy</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:timestamp</span><span class="o">]</span>
<span class="k">end</span>
</pre>
</div>


<h3>iOS 8 Location Requirements</h3>

<p>iOS 8 introduced stricter location services requirements. Although BubbleWrap will handle most of this for you automatically, you are required to add a few key/value pairs to the <code>Info.plist</code>. Add these two lines to your <code>Rakefile</code> (with your descriptions, obviously):</p>

<div class="highlight">
<pre><span class="n">app</span><span class="o">.</span><span class="n">info_plist</span><span class="o">[</span><span class="s1">'NSLocationAlwaysUsageDescription'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Description'</span>
<span class="n">app</span><span class="o">.</span><span class="n">info_plist</span><span class="o">[</span><span class="s1">'NSLocationWhenInUseUsageDescription'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Description'</span>
</pre>
</div>


<p><em>Note: you need both keys to use <code>get_once</code>, so it's probably best to just include both no matter what.</em> See <a href="https://developer.apple.com/library/ios/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW18">Apple's documentation</a> on iOS 8 location services requirements for more information.</p>

<h2>Motion</h2>

<p>Interface for the accelerometer, gyroscope, and magnetometer sensors (the
CoreMotion framework).  You can access each sensor individually, or you can get
data from all of them at once using the <code>BW::Motion.device</code> interface, which
delegates to <code>CMMotionManager#deviceMotion</code>.</p>

<p>Each sensor has an <code>every</code> and <code>once</code> method. <code>every</code> expects a time interval,
and you will need to retain the object it returns and call <code>#stop</code> on it when
you are done with the data.</p>

<p>The <code>every</code> and <code>once</code> methods can accept a <code>:queue</code> option. The default value
is a queue that runs on the main loop, so that UI updates can be processed in
the block. This is useful, but not recommended by Apple, since the events can
come in at a high rate. If you want to use a background queue, you can either
specify an NSOperationQueue object, or you can use one of these symbols:</p>

<ul>
<li>
<code>:main</code> - <code>NSOperationQueue.mainQueue</code>, this is the default value.</li>
<li>
<code>:background</code> - BubbleWrap will create a new <code>NSOperationQueue</code>.</li>
<li>
<code>:current</code> - BubbleWrap will use <code>NSOperationQueue.currentQueue</code>.</li>
</ul>

<p>If you pass a string instead, a new queue will be created and its <code>name</code>
property will be set to that string.</p>

<p>The <code>CMDeviceMotion</code> interface (<code>BW::Motion.device</code>) accepts a <code>:reference</code>
option, which specifies the <code>CMAttitudeReferenceFrame</code>.  The default value is
the same as the one that <code>CMMotionManager</code> uses, which is returned by the
<code>CMMotionManager#attitudeReferenceFrame</code> method.  This option should be passed
to the <code>repeat</code>, <code>every</code> or <code>once</code> methods.</p>

<h6>Accelerometer</h6>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">available?</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># returns CMAccelerometerData object or nil</span>

<span class="c1"># ask the CMMotionManager to update every 5 seconds</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="c1"># result contains the following data (from CMAccelerometerData#acceleration):</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:data</span><span class="o">]</span>  <span class="c1"># the CMAccelerometerData object</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:acceleration</span><span class="o">]</span>  <span class="c1"># the CMAcceleration struct</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:x</span><span class="o">]</span>  <span class="c1"># acceleration in the x direction</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:y</span><span class="o">]</span>  <span class="c1">#          "          y direction</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:z</span><span class="o">]</span>  <span class="c1">#          "          z direction</span>
<span class="k">end</span>

<span class="c1"># every, start, and repeat all need to be stopped later.</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">stop</span>

<span class="c1"># repeat, but don't set the interval</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">repeat</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
<span class="k">end</span>

<span class="c1"># you can specify a :queue where the operations will be executed.  See above for details</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="ss">queue</span><span class="p">:</span> <span class="ss">:background</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="ss">queue</span><span class="p">:</span> <span class="ss">:main</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="ss">queue</span><span class="p">:</span> <span class="ss">:current</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="ss">queue</span><span class="p">:</span> <span class="s1">'my queue'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span>

<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">accelerometer</span><span class="o">.</span><span class="n">once</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
</div>


<h6>Gyroscope</h6>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">gyroscope</span><span class="o">.</span><span class="n">available?</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">gyroscope</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># returns CMGyroData object or nil</span>

<span class="c1"># ask the CMMotionManager to update every second.</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">gyroscope</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="c1"># result contains the following data (from CMGyroData#rotationRate):</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:data</span><span class="o">]</span>  <span class="c1"># the CMGyroData object</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:rotation</span><span class="o">]</span>  <span class="c1"># the CMRotationRate struct</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:x</span><span class="o">]</span>  <span class="c1"># rotation in the x direction</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:y</span><span class="o">]</span>  <span class="c1">#        "        y direction</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:z</span><span class="o">]</span>  <span class="c1">#        "        z direction</span>
<span class="k">end</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">gyroscope</span><span class="o">.</span><span class="n">stop</span>

<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">gyroscope</span><span class="o">.</span><span class="n">once</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
</div>


<h6>Magnetometer</h6>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">magnetometer</span><span class="o">.</span><span class="n">available?</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">magnetometer</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># returns CMMagnetometerData object or nil</span>

<span class="c1"># ask the CMMotionManager to update every second</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">magnetometer</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="c1"># result contains the following data (from CMMagnetometerData#magneticField):</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:data</span><span class="o">]</span>  <span class="c1"># the CMMagnetometerData object</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:field</span><span class="o">]</span>  <span class="c1"># the CMMagneticField struct</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:x</span><span class="o">]</span>  <span class="c1"># magnetic field in the x direction</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:y</span><span class="o">]</span>  <span class="c1">#           "           y direction</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:z</span><span class="o">]</span>  <span class="c1">#           "           z direction</span>
<span class="k">end</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">magnetometer</span><span class="o">.</span><span class="n">stop</span>

<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">magnetometer</span><span class="o">.</span><span class="n">once</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
</div>


<h6>Device Motion</h6>

<p>This is an amalgam of all the motion sensor data.</p>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">available?</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># returns CMDeviceMotion object or nil</span>

<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="c1"># result contains the following data:</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:data</span><span class="o">]</span>  <span class="c1"># the CMDeviceMotion object</span>
  <span class="c1"># orientation data, from CMDeviceMotion#attitude</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:attitude</span><span class="o">]</span>  <span class="c1"># the CMAttitude struct</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:roll</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:pitch</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:yaw</span><span class="o">]</span>
  <span class="c1"># rotation data, from CMDeviceMotion#rotationRate</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:rotation</span><span class="o">]</span>  <span class="c1"># the CMRotationRate struct</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:rotation_x</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:rotation_y</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:rotation_z</span><span class="o">]</span>
  <span class="c1"># gravity+acceleration vector, from CMDeviceMotion#gravity</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:gravity</span><span class="o">]</span>  <span class="c1"># the CMAcceleration struct</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:gravity_x</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:gravity_y</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:gravity_z</span><span class="o">]</span>
  <span class="c1"># just the acceleration vector, from CMDeviceMotion#userAcceleration</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:acceleration</span><span class="o">]</span>  <span class="c1"># the CMAcceleration struct</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:acceleration_x</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:acceleration_y</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:acceleration_z</span><span class="o">]</span>
  <span class="c1"># the magnetic data, from CMDeviceMotion#magneticField</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:magnetic</span><span class="o">]</span>  <span class="c1"># the CMCalibratedMagneticField struct</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:magnetic_field</span><span class="o">]</span>  <span class="c1"># the CMMagneticField struct from the CMCalibratedMagneticField</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:magnetic_x</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:magnetic_y</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:magnetic_z</span><span class="o">]</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:magnetic_accuracy</span><span class="o">]</span>  <span class="c1"># this will be a symbol, :low, :medium, :high, or nil if the magnetic data is uncalibrated</span>

  <span class="c1"># less useful data from CMAttitude, unless you're into the whole linear algebra thing:</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:matrix</span><span class="o">]</span>  <span class="c1"># CMAttitude#rotationMatrix</span>
  <span class="nb">p</span> <span class="n">result</span><span class="o">[</span><span class="ss">:quarternion</span><span class="o">]</span>  <span class="c1"># CMAttitude#quarternion</span>
<span class="k">end</span>

<span class="c1"># the reference frame should be one of the CMAttitudeReferenceFrame constants...</span>
<span class="n">ref</span> <span class="o">=</span> <span class="no">CMAttitudeReferenceFrameXArbitraryZVertical</span>
<span class="c1"># ... or one of these symbols: :arbitrary_z, :corrected_z, :magnetic_north, :true_north</span>
<span class="n">ref</span> <span class="o">=</span> <span class="ss">:corrected_z</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="ss">queue</span><span class="p">:</span> <span class="ss">:background</span><span class="p">,</span> <span class="ss">reference</span><span class="p">:</span> <span class="n">ref</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span>

<span class="no">BW</span><span class="o">::</span><span class="no">Motion</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">once</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
</div>


<h2>Media</h2>

<p>Added wrapper for playing remote and local media. Available are <code>modal</code> and custom presentation styles:</p>

<div class="highlight">
<pre><span class="c1"># Plays in your custom frame</span>
<span class="n">local_file</span> <span class="o">=</span> <span class="no">NSURL</span><span class="o">.</span><span class="n">fileURLWithPath</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">NSBundle</span><span class="o">.</span><span class="n">mainBundle</span><span class="o">.</span><span class="n">resourcePath</span><span class="p">,</span> <span class="s1">'test.mp3'</span><span class="p">))</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Media</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">local_file</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">media_player</span><span class="o">|</span>
  <span class="n">media_player</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="o">]]</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span> <span class="n">media_player</span><span class="o">.</span><span class="n">view</span>
<span class="k">end</span>

<span class="c1"># Plays in an independent modal controller</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Media</span><span class="o">.</span><span class="n">play_modal</span><span class="p">(</span><span class="s2">"http://www.hrupin.com/wp-content/uploads/mp3/testsong_20_sec.mp3"</span><span class="p">)</span>
</pre>
</div>


<h2>Mail</h2>

<p>Wrapper for showing an in-app mail composer view.</p>

<p>You should always determine if the device your app is running on is configured to send mail before displaying a mail composer window. <code>BW::Mail.can_send_mail?</code> will return <code>true</code> or <code>false</code>.</p>

<div class="highlight">
<pre><span class="c1"># Opens as a modal in the current UIViewController</span>
<span class="no">BW</span><span class="o">::</span><span class="no">Mail</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
  <span class="ss">delegate</span><span class="p">:</span> <span class="nb">self</span><span class="p">,</span> <span class="c1"># optional, defaults to rootViewController</span>
  <span class="ss">to</span><span class="p">:</span> <span class="o">[</span> <span class="s2">"tom@example.com"</span> <span class="o">]</span><span class="p">,</span>
  <span class="ss">cc</span><span class="p">:</span> <span class="o">[</span> <span class="s2">"itchy@example.com"</span><span class="p">,</span> <span class="s2">"scratchy@example.com"</span> <span class="o">]</span><span class="p">,</span>
  <span class="ss">bcc</span><span class="p">:</span> <span class="o">[</span> <span class="s2">"jerry@example.com"</span> <span class="o">]</span><span class="p">,</span>
  <span class="ss">html</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span>
  <span class="ss">subject</span><span class="p">:</span> <span class="s2">"My Subject"</span><span class="p">,</span>
  <span class="ss">message</span><span class="p">:</span> <span class="s2">"This is my message. It isn't very long."</span><span class="p">,</span>
  <span class="ss">animated</span><span class="p">:</span> <span class="kp">false</span>
<span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="p">,</span> <span class="n">error</span><span class="o">|</span>
  <span class="n">result</span><span class="o">.</span><span class="n">sent?</span>      <span class="c1"># =&gt; boolean</span>
  <span class="n">result</span><span class="o">.</span><span class="n">canceled?</span>  <span class="c1"># =&gt; boolean</span>
  <span class="n">result</span><span class="o">.</span><span class="n">saved?</span>     <span class="c1"># =&gt; boolean</span>
  <span class="n">result</span><span class="o">.</span><span class="n">failed?</span>    <span class="c1"># =&gt; boolean</span>
  <span class="n">error</span>             <span class="c1"># =&gt; NSError</span>
<span class="k">end</span>
</pre>
</div>


<h2>SMS</h2>

<p>Wrapper for showing an in-app message (SMS) composer view.</p>

<p>You should always determine if the device your app is running on can send SMS messages before displaying a SMS composer window. <code>BW::SMS.can_send_sms?</code> will return <code>true</code> or <code>false</code>.</p>

<div class="highlight">
<pre><span class="c1"># Opens as a modal in the current UIViewController</span>
    <span class="no">BW</span><span class="o">::</span><span class="no">SMS</span><span class="o">.</span><span class="n">compose</span> <span class="p">(</span>
    <span class="p">{</span>
       <span class="ss">delegate</span><span class="p">:</span> <span class="nb">self</span><span class="p">,</span> <span class="c1"># optional, will use root view controller by default</span>
       <span class="ss">to</span><span class="p">:</span> <span class="o">[</span> <span class="s2">"1(234)567-8910"</span> <span class="o">]</span><span class="p">,</span>
       <span class="ss">message</span><span class="p">:</span> <span class="s2">"This is my message. It isn't very long."</span><span class="p">,</span>
       <span class="ss">animated</span><span class="p">:</span> <span class="kp">false</span>
    <span class="p">})</span> <span class="p">{</span><span class="o">|</span><span class="n">result</span><span class="p">,</span> <span class="n">error</span><span class="o">|</span>
       <span class="n">result</span><span class="o">.</span><span class="n">sent?</span>      <span class="c1"># =&gt; boolean</span>
       <span class="n">result</span><span class="o">.</span><span class="n">canceled?</span>  <span class="c1"># =&gt; boolean</span>
       <span class="n">result</span><span class="o">.</span><span class="n">failed?</span>    <span class="c1"># =&gt; boolean</span>
       <span class="n">error</span>             <span class="c1"># =&gt; NSError</span>
      <span class="p">}</span>
</pre>
</div>


<h2>NetworkIndicator</h2>

<p>Wrapper for showing and hiding the network indicator (the status bar spinner).</p>

<div class="highlight">
<pre>    <span class="no">BW</span><span class="o">::</span><span class="no">NetworkIndicator</span><span class="o">.</span><span class="n">show</span>  <span class="c1"># starts the spinner</span>
    <span class="no">BW</span><span class="o">::</span><span class="no">NetworkIndicator</span><span class="o">.</span><span class="n">hide</span>  <span class="c1"># stops it</span>

    <span class="c1"># the nice thing is if you call 'show' multiple times, the 'hide' method will</span>
    <span class="c1"># not have any effect until you've called it the same number of times.</span>
    <span class="no">BW</span><span class="o">::</span><span class="no">NetworkIndicator</span><span class="o">.</span><span class="n">show</span>
    <span class="c1"># ...somewhere else</span>
    <span class="no">BW</span><span class="o">::</span><span class="no">NetworkIndicator</span><span class="o">.</span><span class="n">show</span>

    <span class="c1"># ...down the line</span>
    <span class="no">BW</span><span class="o">::</span><span class="no">NetworkIndicator</span><span class="o">.</span><span class="n">hide</span>
    <span class="c1"># indicator is still visible</span>

    <span class="no">BW</span><span class="o">::</span><span class="no">NetworkIndicator</span><span class="o">.</span><span class="n">hide</span>
    <span class="c1"># NOW the indicator is hidden!</span>

    <span class="c1"># If you *really* want to hide the indicator immediately, you can call `reset!`</span>
    <span class="c1"># but this is in no way encouraged.</span>
    <span class="no">BW</span><span class="o">::</span><span class="no">NetworkIndicator</span><span class="o">.</span><span class="n">reset!</span>

    <span class="c1"># and for completeness, a check to see if the indicator is visible</span>
    <span class="no">BW</span><span class="o">::</span><span class="no">NetworkIndicator</span><span class="o">.</span><span class="n">visible?</span>
</pre>
</div>


<h2>UI</h2>

<h3>Gestures</h3>

<p>Extra methods on <code>UIView</code> for working with gesture recognizers. A gesture recognizer can be added using a normal Ruby block, like so:</p>

<div class="highlight">
<pre>    <span class="n">view</span><span class="o">.</span><span class="n">when_tapped</span> <span class="k">do</span>
      <span class="no">UIView</span><span class="o">.</span><span class="n">animateWithDuration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
        <span class="ss">animations</span><span class="p">:</span><span class="nb">lambda</span> <span class="p">{</span>
          <span class="c1"># animate</span>
          <span class="c1"># @view.transform = ...</span>
        <span class="p">})</span>
    <span class="k">end</span>
</pre>
</div>


<p>There are similar methods for <code>pinched</code>, <code>rotated</code>, <code>swiped</code>, <code>panned</code>, and <code>pressed</code> (for long presses). All of the methods return the actual recognizer object, so it is possible to set the delegate if more fine-grained control is needed.</p>

<p>In order to prevent retain cycles due to strong references within the passed block, use the use_weak_callbacks flag so the blocks do not retain a strong reference to self:</p>

<div class="highlight">
<pre><span class="no">BubbleWrap</span><span class="o">.</span><span class="n">use_weak_callbacks</span> <span class="o">=</span> <span class="kp">true</span>
</pre>
</div>


<h3>UIViewController</h3>

<p>A custom method was added to <code>UIViewController</code> to return the content
frame of a view controller.</p>

<h3>UIControl / UIButton</h3>

<p>Helper methods to give <code>UIButton</code> a Ruby-like interface. Ex:</p>

<div class="highlight">
<pre><span class="n">button</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="no">UIControlEventTouchUpInside</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">redColor</span>
<span class="k">end</span>
</pre>
</div>


<p>The <code>#when</code> method also accepts bitwise combinations of events:</p>

<div class="highlight">
<pre><span class="n">button</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="no">UIControlEventTouchUpInside</span> <span class="o">|</span> <span class="no">UIControlEventTouchUpOutside</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">redColor</span>
<span class="k">end</span>
</pre>
</div>


<p>You can use symbols for events (but won't work with the bitwise operator):</p>

<div class="highlight">
<pre><span class="n">button</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="ss">:touch_up_inside</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">redColor</span>
<span class="k">end</span>

<span class="n">button</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="ss">:value_changed</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">blueColor</span>
<span class="k">end</span>
</pre>
</div>


<p>Set the use_weak_callbacks flag so the blocks do not retain a strong reference to self:</p>

<div class="highlight">
<pre><span class="no">BubbleWrap</span><span class="o">.</span><span class="n">use_weak_callbacks</span> <span class="o">=</span> <span class="kp">true</span>
</pre>
</div>


<h3>UIBarButtonItem</h3>

<p><code>BW::UIBarButtonItem</code> is a subclass of <code>UIBarButtonItem</code> with an natural Ruby syntax.</p>

<h4>Constructors</h4>

<p>Instead specifying a target-action pair, each constructor method accepts an optional block.  When the button is tapped, the block is executed.</p>

<div class="highlight">
<pre><span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="ss">:save</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">title</span> <span class="o">=</span> <span class="s2">"Friends"</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">styled</span><span class="p">(</span><span class="ss">:plain</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">image</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">styled</span><span class="p">(</span><span class="ss">:bordered</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">image</span>     <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
<span class="n">landscape</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">styled</span><span class="p">(</span><span class="ss">:bordered</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">landscape</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
<span class="c1"># NOTE: The block is attached to the view as a single tap gesture recognizer.</span>
</pre>
</div>


<p>The <code>.new</code> constructor provides a flexible, builder-style syntax.</p>

<div class="highlight">
<pre><span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:system</span> <span class="o">=&gt;</span> <span class="ss">:save</span> <span class="p">}</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:styled</span> <span class="o">=&gt;</span> <span class="ss">:plain</span><span class="p">,</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">"Friends"</span> <span class="p">}</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:styled</span> <span class="o">=&gt;</span> <span class="ss">:bordered</span><span class="p">,</span> <span class="ss">:image</span> <span class="o">=&gt;</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span> <span class="p">}</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:styled</span>    <span class="o">=&gt;</span> <span class="ss">:bordered</span><span class="p">,</span>
  <span class="ss">:image</span>     <span class="o">=&gt;</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span><span class="p">,</span>
  <span class="ss">:landscape</span> <span class="o">=&gt;</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
<span class="p">}</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:custom</span> <span class="o">=&gt;</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span> <span class="p">}</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
<span class="c1"># NOTE: The block is attached to the view as a single tap gesture recognizer.</span>
</pre>
</div>


<h4>Button types</h4>

<p>The <code>.styled</code> button types are:</p>

<div class="highlight">
<pre><span class="ss">:plain</span>
<span class="ss">:bordered</span>
<span class="ss">:done</span>
</pre>
</div>


<p>And the <code>.system</code> button types are:</p>

<div class="highlight">
<pre><span class="ss">:done</span>
<span class="ss">:cancel</span>
<span class="ss">:edit</span>
<span class="ss">:save</span>
<span class="ss">:add</span>
<span class="ss">:flexible_space</span>
<span class="ss">:fixed_space</span>
<span class="ss">:compose</span>
<span class="ss">:reply</span>
<span class="ss">:action</span>
<span class="ss">:organize</span>
<span class="ss">:bookmarks</span>
<span class="ss">:search</span>
<span class="ss">:refresh</span>
<span class="ss">:stop</span>
<span class="ss">:camera</span>
<span class="ss">:trash</span>
<span class="ss">:play</span>
<span class="ss">:pause</span>
<span class="ss">:rewind</span>
<span class="ss">:fast_forward</span>
<span class="ss">:undo</span>
<span class="ss">:redo</span>
<span class="ss">:page_curl</span>
</pre>
</div>


<h3>UIActivityViewController</h3>

<p><code>BW::UIActivityViewController</code> is a subclass of <code>UIActivityViewController</code> with an natural Ruby syntax.</p>

<p>You can initiate a <code>UIActivityViewController</code> with or without a completion handler block. For more information on <code>UIActivityViewController</code>s, see <a href="https://developer.apple.com/library/ios/documentation/uikit/reference/UIActivityViewController_Class/Reference/Reference.html">Apple's documentation</a>.</p>

<div class="highlight">
<pre><span class="c1"># Without a completion handler</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIActivityViewController</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
  <span class="ss">items</span><span class="p">:</span> <span class="s2">"Some Text"</span><span class="p">,</span> <span class="c1"># or ["Some Text", NSURL.URLWithString('http://www.rubymotion.com')] or a UIImage</span>
  <span class="ss">animated</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="c1"># Defaults to true</span>
  <span class="ss">excluded</span><span class="p">:</span> <span class="ss">:add_to_reading_list</span> <span class="c1"># One item or an array</span>
<span class="p">)</span>

<span class="c1"># With completion handler</span>
<span class="no">BW</span><span class="o">::</span><span class="no">UIActivityViewController</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
  <span class="ss">items</span><span class="p">:</span> <span class="s2">"Some Text"</span><span class="p">,</span>
  <span class="ss">animated</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
  <span class="ss">excluded</span><span class="p">:</span> <span class="o">[</span><span class="ss">:add_to_reading_list</span><span class="p">,</span> <span class="ss">:print</span><span class="p">,</span> <span class="ss">:air_drop</span><span class="o">]</span>
<span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">activity_type</span><span class="p">,</span> <span class="n">completed</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"completed with activity: </span><span class="si">#{</span><span class="n">activity_type</span><span class="si">}</span><span class="s2"> - finished?: </span><span class="si">#{</span><span class="n">completed</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre>
</div>


<p>Built in activities that can be passed to the <code>excluded</code> option are defined as <code>UIActivity</code> class <code>UIActivityType</code> constants:</p>

<div class="highlight">
<pre><span class="ss">:post_to_facebook</span>
<span class="ss">:post_to_twitter</span>
<span class="ss">:post_to_weibo</span>
<span class="ss">:message</span>
<span class="ss">:mail</span>
<span class="ss">:print</span>
<span class="ss">:copy_to_pasteboard</span>
<span class="ss">:assign_to_contact</span>
<span class="ss">:save_to_camera_roll</span>
<span class="ss">:add_to_reading_list</span>
<span class="ss">:post_to_flickr</span>
<span class="ss">:post_to_vimeo</span>
<span class="ss">:post_to_tencent_weibo</span>
<span class="ss">:air_drop</span>
</pre>
</div>


<h2>RSS Parser</h2>

<p><strong>Since: &gt; version 1.0.0</strong></p>

<p>The RSS Parser provides an easy interface to consume RSS feeds in an
asynchronous (non blocking) way.</p>

<div class="highlight">
<pre><span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"http://feeds2.feedburner.com/sdrbpodcast"</span><span class="p">)</span>
<span class="n">feed_parser</span><span class="o">.</span><span class="n">parse</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
  <span class="c1"># called asynchronously as items get parsed</span>
  <span class="nb">p</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span>
<span class="k">end</span>
</pre>
</div>


<p>The yielded RSS item is of type <code>RSSParser::RSSItem</code> and has the
following attributes:</p>

<ul>
<li>title</li>
<li>description</li>
<li>link</li>
<li>guid</li>
<li>pubDate</li>
<li>enclosure</li>
</ul>

<p>The item can be converted into a hash by calling <code>to_hash</code> on it.</p>

<h3>Delegate</h3>

<p><strong>Since: &gt; version 1.0.0</strong></p>

<p>You can also designate a delegate to the parser and implement change
state callbacks:</p>

<div class="highlight">
<pre><span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"http://feeds.feedburner.com/sdrbpodcast"</span><span class="p">)</span>
<span class="n">feed_parser</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span>
<span class="n">feed_parser</span><span class="o">.</span><span class="n">parse</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
  <span class="nb">p</span> <span class="n">item</span><span class="o">.</span><span class="n">title</span>
<span class="k">end</span>

<span class="c1"># Delegate method</span>
<span class="k">def</span> <span class="nf">when_parser_initializes</span>
  <span class="nb">p</span> <span class="s2">"The parser is ready!"</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">when_parser_parses</span>
  <span class="nb">p</span> <span class="s2">"The parser started parsing the document"</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">when_parser_is_done</span>
  <span class="nb">p</span> <span class="s2">"The feed is entirely parsed, congratulations!"</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">when_parser_errors</span>
  <span class="nb">p</span> <span class="s2">"The parser encountered an error"</span>
  <span class="n">ns_error</span> <span class="o">=</span> <span class="n">feed_parser</span><span class="o">.</span><span class="n">parserError</span>
  <span class="nb">p</span> <span class="n">ns_error</span><span class="o">.</span><span class="n">localizedDescription</span>
<span class="k">end</span>
</pre>
</div>


<p>These delegate methods are optional, however, you might find the
<code>when_parser_is_done</code> callback useful if you collected all the items and
want to process all at once for instance.</p>

<h3>Parsing a remote content or actual data</h3>

<p>You have the choice to initialize a parser instance with a string
representing an URL, an instance of <code>NSURL</code> or my specifying that the
passed param is some data to parse directly.</p>

<div class="highlight">
<pre><span class="c1"># string representing an url:</span>
<span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"http://feeds2.feedburner.com/sdrbpodcast"</span><span class="p">)</span>
<span class="c1"># a NSURL instance:</span>
<span class="n">url</span> <span class="o">=</span>  <span class="no">NSURL</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithString</span><span class="p">(</span><span class="s2">"http://matt.aimonetti.net/atom.xml"</span><span class="p">)</span>
<span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># Some data</span>
<span class="n">feed</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'atom.xml'</span><span class="p">)</span>
<span class="n">feed_parser</span> <span class="o">=</span> <span class="no">BW</span><span class="o">::</span><span class="no">RSSParser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span>
</pre>
</div>


<h2>Reactor</h2>

<p><strong>Since: &gt; version 1.0.0</strong></p>

<p><code>BW::Reactor</code> is a simplified, mostly complete implementation of
the <a href="http://rubyeventmachine.com/">Event Machine</a> API.  In fact
<code>BW::Reactor</code> is aliased to <code>EM</code> in the runtime environment.</p>

<h3>Deferables</h3>

<p>BubbleWrap provides both a <code>Deferrable</code> mixin and a <code>DefaultDeferrable</code>
class, which simply mixes in deferrable behaviour if you don't want to
implement your own.</p>

<p>A deferrable is an object with four states: unknown, successful, failure
and timeout.  When you initially create a deferrable it is in an unknown
state, however you can assign callbacks to be run when the object
changes to either successful or failure state.</p>

<p>Using <code>delegate</code>, <code>errback_delegate</code> and <code>callback_delegate</code> you can link
deferrables together.</p>

<p>By default, callbacks will be made on the thread that the deferrable
succeeds/fails on. For multithreaded environments, it can be useful to use
EM::ThreadAwareDeferrable so that callbacks will be made on the threads they
are declared on.</p>

<h4>Success</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BW::Reactor::DefaultDeferrable:0x6d859a0&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">callback</span> <span class="p">{</span> <span class="o">|</span><span class="n">what</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"Great </span><span class="si">#{</span><span class="n">what</span><span class="si">}</span><span class="s2">!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x6d8a1e0&gt;]</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">succeed</span> <span class="s2">"justice"</span>
<span class="no">Great</span> <span class="n">justice!</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre>
</div>


<h4>Failure</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BW::Reactor::DefaultDeferrable:0x8bf3ee0&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">errback</span> <span class="p">{</span> <span class="o">|</span><span class="n">what</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"Great </span><span class="si">#{</span><span class="n">what</span><span class="si">}</span><span class="s2">!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x8bf3ef0&gt;]</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">fail</span> <span class="s2">"sadness"</span>
<span class="no">Great</span> <span class="n">sadness!</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre>
</div>


<h4>Delegate</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BW::Reactor::DefaultDeferrable:0x8bf3ee0&gt;</span>
<span class="o">&gt;</span> <span class="n">delegate</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BW::Reactor::DefaultDeferrable:0x8bf5910&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">delegate</span> <span class="n">delegate</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BW::Reactor::DefaultDeferrable:0x8bf3ee0&gt;</span>
<span class="o">&gt;</span> <span class="n">delegate</span><span class="o">.</span><span class="n">callback</span> <span class="p">{</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">args</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x8bf3ef0&gt;]</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">succeed</span> <span class="ss">:passed</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:passed</span><span class="o">]</span>
</pre>
</div>


<h4>DependentDeferrable</h4>

<p><code>DependentDeferrable</code> depends on children deferrables. A <code>DependentDeferrable</code>
succeeds only when every child succeeds and fails immediately when any child
fails</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d1</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BubbleWrap::Reactor::DefaultDeferrable:0x10c713750&gt;</span>
<span class="o">&gt;</span> <span class="n">d2</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BubbleWrap::Reactor::DefaultDeferrable:0x10370bb10&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DependentDeferrable</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BubbleWrap::Reactor::DependentDeferrable:0x106c17b80&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">callback</span> <span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"a: </span><span class="si">#{</span><span class="n">a</span><span class="si">}</span><span class="s2"> b: </span><span class="si">#{</span><span class="n">b</span><span class="si">}</span><span class="s2">"</span><span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x103075210&gt;]</span>
<span class="o">&gt;</span> <span class="n">d1</span><span class="o">.</span><span class="n">succeed</span> <span class="s1">'one'</span><span class="p">,</span> <span class="s1">'one more'</span>
<span class="o">&gt;</span> <span class="n">d2</span><span class="o">.</span><span class="n">succeed</span> <span class="ss">:two</span>
<span class="ss">a</span><span class="p">:</span> <span class="o">[</span><span class="s2">"one"</span><span class="p">,</span> <span class="s2">"one more"</span><span class="o">]</span> <span class="ss">b</span><span class="p">:</span> <span class="o">[</span><span class="ss">:two</span><span class="o">]</span>
</pre>
</div>


<h4>ThreadAwareDeferrable</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">ThreadAwareDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BW::Reactor::ThreadAwareDeferrable:0x8bf3ee0&gt;</span>

<span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="no">Dispatch</span><span class="o">::</span><span class="no">Queue</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:deferrable</span><span class="o">.</span><span class="n">to_s</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">queue</span><span class="o">.</span><span class="n">async</span> <span class="k">do</span>
<span class="o">&gt;</span>   <span class="n">d</span><span class="o">.</span><span class="n">callback</span> <span class="k">do</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span>
<span class="o">&gt;</span>     <span class="no">Dispatch</span><span class="o">::</span><span class="no">Queue</span><span class="o">.</span><span class="n">current</span> <span class="o">==</span> <span class="n">queue</span>
<span class="o">&gt;</span>     <span class="o">=&gt;</span> <span class="kp">true</span> <span class="c1"># this is normally false</span>
<span class="o">&gt;</span>   <span class="k">end</span>
<span class="o">&gt;</span> <span class="k">end</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">succeed</span> <span class="kp">true</span>
</pre>
</div>


<h4>Timeout</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">EM</span><span class="o">::</span><span class="no">DefaultDeferrable</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BW::Reactor::DefaultDeferrable:0x8bf5910&gt;</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">errback</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Great scott!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0x8bf6350&gt;]</span>
<span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">timeout</span> <span class="mi">2</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;BW::Reactor::Timer:0x6d920a0 @timer=#&lt;__NSCFTimer:0x6d91990&gt;&gt;</span>
<span class="c1"># wait...</span>
<span class="o">&gt;</span> <span class="no">Great</span> <span class="n">scott!</span>
</pre>
</div>


<h3>Timers</h3>

<p><em>All timers can be cancelled using <code>EM.cancel_timer</code>.</em></p>

<h4>One-shot timers</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">EM</span><span class="o">.</span><span class="n">add_timer</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">do</span>
<span class="o">&gt;</span>   <span class="nb">puts</span> <span class="s2">"Great scott!"</span>
<span class="o">&gt;</span> <span class="k">end</span>
<span class="o">=&gt;</span> <span class="mi">146335904</span>
<span class="o">&gt;</span> <span class="no">Great</span> <span class="n">scott!</span>
</pre>
</div>


<h4>Periodic timers</h4>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">=&gt;</span> <span class="mi">0</span>
<span class="o">&gt;</span> <span class="n">timer</span> <span class="o">=</span> <span class="no">EM</span><span class="o">.</span><span class="n">add_periodic_timer</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">do</span>
<span class="o">&gt;</span>   <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">&gt;</span>   <span class="nb">puts</span> <span class="s2">"Great scott!"</span>
<span class="o">&gt;</span>   <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="no">EM</span><span class="o">.</span><span class="n">cancel_timer</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="k">end</span>
<span class="o">=&gt;</span> <span class="mi">146046832</span>
<span class="o">&gt;</span> <span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
<span class="no">Great</span> <span class="n">scott!</span>
</pre>
</div>


<h3>Scheduling operations</h3>

<p>You can use <code>EM.schedule</code> to schedule blocks to be executed
asynchronously.  BubbleWrap deviates from the EventMachine
API here in that it also provides <code>EM.schedule_on_main</code> which
makes sure that the task is run asynchronously, but on the
application's main thread - this is necessary if you are
updating the user interface.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="no">EM</span><span class="o">.</span><span class="n">schedule</span> <span class="p">{</span> <span class="nb">puts</span> <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">object_id</span> <span class="p">}</span>
<span class="mi">146027920</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="o">&gt;</span> <span class="no">EM</span><span class="o">.</span><span class="n">schedule_on_main</span> <span class="p">{</span> <span class="nb">puts</span> <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">object_id</span> <span class="p">}</span>
<span class="mi">112222480</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre>
</div>


<h3>Deferrable operations</h3>

<p>You can also use <code>EM.defer</code> in much the same way as <code>EM.schedule</code>
with one important difference, you can pass in a second <code>proc</code>
which will be called when the first has completed, and be passed
it's result as an argument. Just like <code>EM.schedule</code>, <code>EM.defer</code>
also has an <code>EM.defer_on_main</code> version.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">operation</span> <span class="o">=</span> <span class="nb">proc</span> <span class="p">{</span> <span class="mi">88</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Proc:0x6d763c0&gt;</span>
<span class="o">&gt;</span> <span class="n">callback</span> <span class="o">=</span> <span class="nb">proc</span> <span class="p">{</span> <span class="o">|</span><span class="n">speed</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">speed</span> <span class="o">&gt;=</span> <span class="mi">88</span> <span class="o">?</span> <span class="s2">"Time travel!"</span> <span class="p">:</span> <span class="s2">"Conventional travel!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Proc:0x8bd3910&gt;</span>
<span class="o">&gt;</span> <span class="no">EM</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="no">Time</span> <span class="n">travel!</span>
</pre>
</div>


<h3>Events</h3>

<p>Although not part of the EventMachine API, BubbleWrap provides
an <code>Eventable</code> mixin for use instrumenting objects with simple
event triggering behaviour. <code>BW::Reactor</code> uses this
behind the scenes in several places, and as it's a very handy
idiom it is available as a public API.</p>

<div class="highlight">
<pre><span class="o">&gt;</span> <span class="n">o</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="kp">include</span> <span class="no">EM</span><span class="o">::</span><span class="no">Eventable</span> <span class="p">}</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;#&lt;Class:0xab63f00&gt;:0xab64430&gt;</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Ow!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0xad9bf00&gt;]</span>
<span class="o">&gt;</span> <span class="n">flux</span> <span class="o">=</span> <span class="nb">proc</span><span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Flux capacitor!"</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Proc:0xab630f0&gt;</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flux</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;Proc:0xad9bf00&gt;, #&lt;Proc:0xab630f0&gt;]</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span>
<span class="no">Ow</span><span class="o">!</span>
<span class="no">Flux</span> <span class="n">capacitor!</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="o">]</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">off</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flux</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Proc:0xab630f0&gt;</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span>
<span class="no">Ow</span><span class="o">!</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="kp">nil</span><span class="o">]</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Ow!"</span> <span class="p">}</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"Another Ow!"</span> <span class="p">}</span>
<span class="o">&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">off</span><span class="p">(</span><span class="ss">:november_5_1955</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre>
</div>


<h1>Contributing</h1>

<p>Do you have a suggestion for a specific wrapper? Feel free to open an
issue/ticket and tell us about what you are after. If you have a
wrapper/helper you are using and are thinking that others might enjoy,
please send a pull request with tests. If you need help writing the tests,
send the pull request anyways and we'll try to help you out with that.</p>

<ol>
<li>Create an issue in GitHub to make sure your PR will be accepted</li>
<li>Fork the BubbleWrap repository</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Write tests for your changes and ensure they pass locally (<code>bundle exec rake spec &amp;&amp; bundle exec rake spec osx=true</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol>
</body></html>

       </section>
       <footer>
       <p>Maintained by:</p>
       <ul>
         <li><a href="https://github.com/markrickert"><img src="https://avatars0.githubusercontent.com/u/139261?v=3&s=24">Mark Rickert</a><a href="http://twitter.com/markrickert"><small>@markrickert</small></a></li>
         <li><a href="https://github.com/clayallsopp"><img src="https://avatars0.githubusercontent.com/u/153704?v=3&s=24">Clay Allsopp</a><a href="http://twitter.com/clayallsopp"><small>@clayallsopp</small></a></li>
         <li><a href="https://github.com/jamesotron"><img src="https://avatars0.githubusercontent.com/u/59449?v=3&s=24">James Harton</a><a href="http://twitter.com/jamesotron"><small>@jamesotron</small></a></li>
         <li><a href="https://github.com/supermarin"><img src="https://avatars0.githubusercontent.com/u/627285?v=3&s=24">Marin Usalj</a><a href="http://twitter.com/_supermarin"><small>@_supermarin</small></a></li>
       </ul>
       <p>Started by:</p>
       <ul>
         <li><a href="https://github.com/mattetti/"><img src="https://avatars0.githubusercontent.com/u/113?v=3&s=24">Matt Aimonetti</a><a href="http://twitter.com/merbist"><small>@merbist</small></a><li>
       </ul>
       </footer>
     </div>
     <script src="javascripts/scale.fix.js"></script>

   </body>
 </html>
